#!/usr/bin/env node

var _ventricle = require("../lib/ventricle")
  , _optimist  = require("optimist")
  , _url       = require("url")
  , _fs        = require("fs")
  , argv       = _optimist.default({'port': 4567}).argv
  , server     = _ventricle.start(argv.port)
  , hosts      = argv._;


for (var k = hosts.length; k --; ) {
  var parts   = hosts[k].split(':')
    , urlpath = parts[0]
    , docroot = parts[1];

  if (!urlpath || !docroot) {
    console.error('Expected urlpath:docroot but got ' + hosts[k]);
    process.exit(1);
  }

  if (urlpath == 'file')
    server.mount('file:', docroot);
  else {
    var url     = _url.parse('http://' + urlpath)
      , host    = url.hostname
      , urlpath = url.pathname || '/';

    server.mount(host, docroot, urlpath);
  }

}

console.info('Ready on port ' + argv.port);
console.info('  http://localhost:' + argv.port + '/ventricle');
